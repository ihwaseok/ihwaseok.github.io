---
title: CTE
updated: 2023-01-20 06:41:38Z
created: 2023-01-18 07:11:05Z
latitude: 37.44491680
longitude: 127.13886840
altitude: 0.0000
sidebar: mydoc_sidebar1
permalink: Ⅰ.=프로그래밍=언어_03.=SQL_1.=ANSI=SQL_CTE.html
folder: mydoc
---

## Common Table Expression (CTE)
- 공통 테이블 식
- DML이 하나의 실행 범위 내에서 정의되는 임시 결과 집합
- 주로 계층형 데이터를 조회하기 위하여 사용한다
  ex) 사원~관리자, 제품~담당자

```sql
WITH TEST AS (
	SELECT 'A' AS MY_ID, NULL AS PARENT_ID UNION ALL
	SELECT 'B' AS MY_ID, 'A' AS PARENT_ID UNION ALL
	SELECT 'C' AS MY_ID, 'A' AS PARENT_ID UNION ALL
	SELECT 'D' AS MY_ID, 'A' AS PARENT_ID UNION ALL
	SELECT 'E' AS MY_ID, 'B' AS PARENT_ID UNION ALL
	SELECT 'F' AS MY_ID, 'B' AS PARENT_ID UNION ALL
	SELECT 'G' AS MY_ID, 'C' AS PARENT_ID 
),
CTE AS 
(
	-- ROOT
	SELECT MY_ID
		   , PARENT_ID
		   , 0 AS LEVEL
		   , CAST('100' AS VARCHAR) AS SORT_CODE
	FROM TEST
	WHERE PARENT_ID IS NULL
	
	-- ROOT를 이용해 재귀 반복할 테이블 기술
	UNION ALL
	SELECT ROOT.MY_ID
		   , ROOT.PARENT_ID
		   , (CHILD.LEVEL + 1) AS LEVEL
		   , CAST(CONCAT(CHILD.SORT_CODE, '_', 100 + ROW_NUMBER() OVER (ORDER BY CHILD.MY_ID)) AS VARCHAR) AS SORT_CODE
	FROM TEST AS ROOT
	INNER JOIN CTE AS CHILD
		ON ROOT.PARENT_ID = CHILD.MY_ID
)

SELECT *
FROM CTE
ORDER BY SORT_CODE
;
```

|MY_ID|PARENT_ID|LEVEL|SORT_CODE|
|--|--|--|--|
|A	|NULL	|0	|100        |
|B	|A	    |1	|100_101    |
|E	|B	    |2	|100_101_101|
|F	|B	    |2	|100_101_102|
|C	|A	    |1	|100_102    |
|G	|C	    |2	|100_102_101|
|D	|A	    |1	|100_103    |
