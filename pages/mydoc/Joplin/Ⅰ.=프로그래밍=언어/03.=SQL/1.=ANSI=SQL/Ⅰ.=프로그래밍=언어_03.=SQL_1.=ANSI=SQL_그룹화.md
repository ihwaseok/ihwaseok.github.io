---
title: 그룹화
updated: 2023-01-18 09:10:21Z
created: 2023-01-16 09:03:25Z
latitude: 37.44491680
longitude: 127.13886840
altitude: 0.0000
sidebar: mydoc_sidebar1
permalink: Ⅰ.=프로그래밍=언어_03.=SQL_1.=ANSI=SQL_그룹화.html
folder: mydoc
---

## GROUP BY
- 데이터를 작은 그룹으로 분류하여 소그룹에 대한 항목별로 통계정보를 얻을때 사용
- 소그룹별 기준을 정한뒤 `SELECT`에서 집계함수를 사용

```sql
-- 데이터를 국가별로 그룹화하고 국가별로 얼마나 있는지 출력
SELECT COUNTRY, COUNT(*) AS CNT
FROM TEST
GROUP BY COUNTRY
;
```

<br>

## HAVING
- 데이터를 그룹화 한뒤 집계함수를 이용하는 조건절

```sql
-- 데이터를 국가별로 그룹화하고 5명 이상 집계되는 국가만 얼마나 있는지 출력
SELECT COUNTRY, COUNT(*) AS CNT
FROM TEST
GROUP BY COUNTRY
HAVING COUNT(ID) >= 5
;
```

<br>

## 집계함수
- 여러 행들의 그룹이 모여서 그룹당 단 하나의 결과를 반환하는 함수
- `SELECT`, `HAVING`, `ORDER BY`에 사용 가능

|이름|내용|
|---|---|
|COUNT()| Null 값을 제외한 행의 수를 출력 (\*을 사용하면 Null 포함)|
|SUM()| Null 값을 제외한 합계를 출력|
|AVG()| Null 값을 제외한 평균을 출력|
|MAX()| 최대값을 출력|
|MIN()| 최소값을 출력|

<br>

## ROLLUP
- 소그룹 간의 소계를 계산
- 그룹화된 행의 하단에 소계가 출력
- 인수는 계층 구조이기 때문에 인수 순서가 바뀌면 결과도 바뀐다
- 병렬수행 가능

```sql
WITH TEST AS (
  SELECT 'ALPHA' AS CATEGORY, 'A' AS NAME, 10 AS NUM UNION ALL
  SELECT 'ALPHA' AS CATEGORY, 'B' AS NAME, 20 AS NUM UNION ALL
  
  SELECT 'BETA' AS CATEGORY, 'ACE' AS NAME, 100 AS NUM UNION ALL
  SELECT 'BETA' AS CATEGORY, 'BLACK' AS NAME, 200 AS NUM UNION ALL
  
  SELECT 'GAMMA' AS CATEGORY, 'XXX' AS NAME, 1000 AS NUM UNION ALL
  SELECT 'GAMMA' AS CATEGORY, 'YYY' AS NAME, 2000 AS NUM
)

-- 기본 사용법
SELECT CATEGORY, NAME, SUM(NUM) AS PRICE
FROM TEST
GROUP BY ROLLUP (CATEGORY, NAME)
;

-- 기본 사용법 2
SELECT CATEGORY, NAME, SUM(NUM) AS PRICE
FROM TEST
GROUP BY CATEGORY, NAME
WITH ROLLUP
;

-- HAVING을 사용하여 전체 합계만 출력
SELECT CATEGORY, NAME, SUM(NUM) AS PRICE
FROM TEST
GROUP BY ROLLUP (CATEGORY, NAME)
HAVING GROUPING(CATEGORY) = 1 OR GROUPING(NAME) = 0
;
```

|CATEGORY	|NAME	|PRICE|
|--|--|--|
|ALPHA	    |A	    |10   |
|ALPHA	    |B	    |20   |
|<span style="color:red">ALPHA</span>|<span style="color:red">NULL</span>|<span style="color:red">30</span>|
|BETA	    |ACE    |100  |
|BETA	    |BLACK	|200  |
|<span style="color:red">BETA</span>|<span style="color:red">NULL</span>|<span style="color:red">300</span>|
|GAMMA	    |XXX	|1000 |
|GAMMA	    |YYY	|2000 |
|<span style="color:red">GAMMA</span>|<span style="color:red">NULL</span>|<span style="color:red">3000</span>|
|<span style="color:red">NULL</span>|<span style="color:red">NULL</span>|<span style="color:red">3330</span>|

<br>

## CUBE
- `GROUP BY` 항목들 간의 다차원적인 소계를 계산
- 그룹화된 컬럼이 가질 수 있는 모든 경우의 소계 생성
- 성능상 사용에 주의 필요
- 인수가 계층구조가 아니기 때문에 인수 순서 상관없음

```sql
SELECT CATEGORY, NAME, SUM(NUM) AS PRICE
FROM TEST
GROUP BY CUBE (CATEGORY, NAME)
```

|CATEGORY	|NAME	|PRICE|
|--|--|--|
|ALPHA	    |A	    |10   |
|<span style="color:red">NULL</span>|<span style="color:red">A</span>|<span style="color:red">10</span>|
|BETA	    |ACE	    |100  |
|<span style="color:red">NULL</span>	    |<span style="color:red">ACE</span>|<span style="color:red">100</span>|
|ALPHA	    |B	    |20   |
|<span style="color:red">NULL</span>	    |<span style="color:red">B</span>|<span style="color:red">20</span>|
|BETA	    |BLACK	|200  |
|<span style="color:red">NULL</span>	    |<span style="color:red">BLACK</span>|<span style="color:red">200</span>|
|GAMMA	    |XXX	    |1000 |
|<span style="color:red">NULL</span>	    |<span style="color:red">XXX</span>|<span style="color:red">1000</span>|
|GAMMA	    |YYY	    |2000 |
|<span style="color:red">NULL</span>	    |<span style="color:red">YYY</span>|<span style="color:red">2000</span>|
|<span style="color:red">NULL</span>	    |<span style="color:red">NULL</span>|<span style="color:red">3330</span>|
|<span style="color:red">ALPHA</span>|<span style="color:red">NULL</span>	|<span style="color:red">30</span>|
|<span style="color:red">BETA</span>|<span style="color:red">NULL</span>	|<span style="color:red">300</span>|
|<span style="color:red">GAMMA</span>|<span style="color:red">NULL</span>	|<span style="color:red">3000</span>|

<br>

## GROUPING SETS
- 특정 항목에 대한 소계를 계산
- 인수의 순서가 바뀌어도 결과는 같다

```sql
SELECT CATEGORY, NAME, SUM(NUM) AS PRICE
FROM TEST
GROUP BY GROUPING SETS (CATEGORY, NAME)
```

|CATEGORY	|NAME	|PRICE|
|--|--|--|
|NULL	    |A	    |10   |
|NULL	    |ACE	    |100  |
|NULL	    |B	    |20   |
|NULL	    |BLACK	|200  |
|NULL	    |XXX	    |1000 |
|NULL	    |YYY	    |2000 |
|ALPHA	    |NULL	|30   |
|BETA	    |NULL	|300  |
|GAMMA	    |NULL	|3000 |
